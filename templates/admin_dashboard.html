{% extends "base.html" %}

{% block title %}لوحة تحكم المسؤول - لوحة تحكم المصمم{% endblock %}

{% block content %}
<!-- رأس لوحة التحكم -->
<div class="mb-8">
    <div class="flex items-center justify-between">
        <div>
            <h1 class="text-3xl font-bold text-gray-900">لوحة تحكم المسؤول</h1>
            <p class="text-gray-600 mt-1">مرحباً بك، {{ current_user.full_name }}</p>
        </div>
        <div class="flex space-x-3 space-x-reverse">
            <button class="bg-primary text-white px-4 py-2 rounded-lg hover:opacity-90 transition-colors">
                <i class="fas fa-plus ml-2"></i>
                مشروع جديد
            </button>
        </div>
    </div>
</div>

<!-- بطاقات الإحصائيات -->
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
    <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-100">
        <div class="flex items-center">
            <div class="p-3 bg-blue-100 rounded-lg">
                <i class="fas fa-project-diagram text-blue-600 text-xl"></i>
            </div>
            <div class="mr-4">
                <p class="text-sm font-medium text-gray-600">إجمالي المشاريع</p>
                <p class="text-2xl font-bold text-gray-900">{{ stats.total_projects }}</p>
            </div>
        </div>
    </div>

    <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-100">
        <div class="flex items-center">
            <div class="p-3 bg-orange-100 rounded-lg">
                <i class="fas fa-clock text-orange-600 text-xl"></i>
            </div>
            <div class="mr-4">
                <p class="text-sm font-medium text-gray-600">قيد التنفيذ</p>
                <p class="text-2xl font-bold text-gray-900">{{ stats.in_progress }}</p>
            </div>
        </div>
    </div>

    <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-100">
        <div class="flex items-center">
            <div class="p-3 bg-green-100 rounded-lg">
                <i class="fas fa-check-circle text-green-600 text-xl"></i>
            </div>
            <div class="mr-4">
                <p class="text-sm font-medium text-gray-600">مكتملة</p>
                <p class="text-2xl font-bold text-gray-900">{{ stats.completed }}</p>
            </div>
        </div>
    </div>

    <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-100">
        <div class="flex items-center">
            <div class="p-3 bg-purple-100 rounded-lg">
                <i class="fas fa-users text-purple-600 text-xl"></i>
            </div>
            <div class="mr-4">
                <p class="text-sm font-medium text-gray-600">العملاء</p>
                <p class="text-2xl font-bold text-gray-900">{{ stats.total_clients }}</p>
            </div>
        </div>
    </div>
</div>

<div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
    <!-- المشاريع قيد التنفيذ -->
    <div class="bg-white rounded-xl shadow-sm border border-gray-100">
        <div class="p-6 border-b border-gray-100">
            <div class="flex items-center justify-between">
                <h2 class="text-xl font-semibold text-gray-900">المشاريع قيد التنفيذ</h2>
                <a href="{{ url_for('admin_projects') }}" class="text-primary hover:text-primary-dark text-sm font-medium">
                    عرض الكل
                </a>
            </div>
        </div>
        <div class="p-6">
            {% if in_progress_projects %}
                <div class="space-y-4">
                    {% for project in in_progress_projects %}
                    <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                        <div class="flex-1">
                            <h3 class="font-medium text-gray-900">{{ project.title }}</h3>
                            <p class="text-sm text-gray-600">{{ project.client.full_name }}</p>
                            <div class="flex items-center mt-2">
                                <div class="w-16 bg-gray-200 rounded-full h-2 mr-2">
                                    <div class="bg-primary h-2 rounded-full" style="width: {{ project.progress }}%"></div>
                                </div>
                                <span class="text-xs text-gray-500">{{ project.progress }}%</span>
                            </div>
                        </div>
                        <div class="text-right">
                            <span class="text-sm font-medium text-gray-900">{{ project.budget|number_format }} ريال</span>
                            <p class="text-xs text-gray-500">{{ project.due_date.strftime('%d/%m') }}</p>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <p class="text-gray-500 text-center py-8">لا توجد مشاريع قيد التنفيذ حالياً</p>
            {% endif %}
        </div>
    </div>

    <!-- طلبات جديدة -->
    <div class="bg-white rounded-xl shadow-sm border border-gray-100">
        <div class="p-6 border-b border-gray-100">
            <div class="flex items-center justify-between">
                <h2 class="text-xl font-semibold text-gray-900">طلبات جديدة</h2>
                <span class="bg-blue-100 text-blue-800 text-xs font-medium px-2.5 py-0.5 rounded-full">
                    {{ stats.new_projects }} جديد
                </span>
            </div>
        </div>
        <div class="p-6">
            {% if new_projects %}
                <div class="space-y-4">
                    {% for project in new_projects %}
                    <div class="flex items-center justify-between p-4 bg-blue-50 rounded-lg">
                        <div class="flex-1">
                            <h3 class="font-medium text-gray-900">{{ project.title }}</h3>
                            <p class="text-sm text-gray-600">{{ project.client.full_name }}</p>
                            <p class="text-xs text-gray-500 mt-1">{{ project.created_at.strftime('%d/%m/%Y') }}</p>
                        </div>
                        <div class="text-right">
                            <span class="text-sm font-medium text-gray-900">{{ project.budget|number_format }} ريال</span>
                            <div class="mt-2">
                                <button onclick="updateProjectStatus({{ project.id }}, 'قيد التنفيذ')"
                                        class="bg-green-500 text-white text-xs px-3 py-1 rounded hover:bg-green-600 transition-colors">
                                    قبول
                                </button>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <p class="text-gray-500 text-center py-8">لا توجد طلبات جديدة</p>
            {% endif %}
        </div>
    </div>

    <!-- المواعيد النهائية القريبة -->
    <div class="bg-white rounded-xl shadow-sm border border-gray-100">
        <div class="p-6 border-b border-gray-100">
            <h2 class="text-xl font-semibold text-gray-900">المواعيد النهائية القريبة</h2>
        </div>
        <div class="p-6">
            {% if upcoming_deadlines %}
                <div class="space-y-3">
                    {% for project in upcoming_deadlines %}
                    <div class="flex items-center justify-between p-3 bg-red-50 rounded-lg">
                        <div class="flex-1">
                            <h4 class="font-medium text-gray-900">{{ project.title }}</h4>
                            <p class="text-sm text-gray-600">{{ project.client.full_name }}</p>
                        </div>
                        <div class="text-right">
                            <span class="text-sm font-medium text-red-600">{{ project.due_date.strftime('%d/%m') }}</span>
                            <p class="text-xs text-gray-500">{{ (project.due_date - date.today()).days }} يوم متبقي</p>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <p class="text-gray-500 text-center py-8">لا توجد مواعيد نهائية قريبة</p>
            {% endif %}
        </div>
    </div>

    <!-- إحصائيات شهرية -->
    <div class="bg-white rounded-xl shadow-sm border border-gray-100">
        <div class="p-6 border-b border-gray-100">
            <h2 class="text-xl font-semibold text-gray-900">إحصائيات الشهر الحالي</h2>
        </div>
        <div class="p-6">
            <div class="space-y-4">
                <div class="flex justify-between items-center">
                    <span class="text-gray-600">مشاريع مكتملة</span>
                    <span class="font-semibold text-green-600">{{ monthly_stats.projects_completed }}</span>
                </div>
                <div class="flex justify-between items-center">
                    <span class="text-gray-600">الإيرادات</span>
                    <span class="font-semibold text-green-600">{{ monthly_stats.revenue|number_format }} ريال</span>
                </div>
                <div class="flex justify-between items-center">
                    <span class="text-gray-600">عملاء جدد</span>
                    <span class="font-semibold text-blue-600">{{ monthly_stats.new_clients }}</span>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- قسم سريع للمهام اليومية -->
<div class="mt-8 bg-white rounded-xl shadow-sm border border-gray-100">
    <div class="p-6 border-b border-gray-100">
        <h2 class="text-xl font-semibold text-gray-900">المهام اليومية</h2>
    </div>
    <div class="p-6">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <button class="p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-primary hover:bg-primary hover:bg-opacity-5 transition-colors text-center">
                <i class="fas fa-plus text-2xl text-gray-400 mb-2"></i>
                <p class="text-sm text-gray-600">إضافة مهمة جديدة</p>
            </button>
            <button class="p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-primary hover:bg-primary hover:bg-opacity-5 transition-colors text-center">
                <i class="fas fa-calendar-plus text-2xl text-gray-400 mb-2"></i>
                <p class="text-sm text-gray-600">جدولة اجتماع</p>
            </button>
            <button class="p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-primary hover:bg-primary hover:bg-opacity-5 transition-colors text-center">
                <i class="fas fa-chart-bar text-2xl text-gray-400 mb-2"></i>
                <p class="text-sm text-gray-600">عرض التقارير</p>
            </button>
        </div>
    </div>
</div>
{% endblock %}
